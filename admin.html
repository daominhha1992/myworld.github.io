<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Qu·∫£n l√Ω s·∫£n ph·∫©m</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 30px auto; }
    input, button, textarea { margin: 5px 0; width: 100%; padding: 6px; }
    .item { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; border-radius: 8px; }
  </style>
</head>
<body>
  <h1>üõ†Ô∏è Qu·∫£n l√Ω s·∫£n ph·∫©m</h1>
  <div id="list"></div>

  <h2>Th√™m / S·ª≠a s·∫£n ph·∫©m</h2>
  <form id="productForm">
    <input id="id" placeholder="ID (ƒë·ªÉ tr·ªëng ƒë·ªÉ t·∫°o m·ªõi)">
    <input id="name" placeholder="T√™n s·∫£n ph·∫©m">
    <input id="brand" placeholder="H√£ng">
    <input id="cpu" placeholder="CPU">
    <input id="ram" placeholder="RAM">
    <input id="ssd" placeholder="SSD">
    <input id="screen" placeholder="M√†n h√¨nh">
    <input id="price" placeholder="Gi√° (s·ªë)">
    <input id="img" placeholder="Link ·∫£nh">
    <textarea id="desc" placeholder="M√¥ t·∫£"></textarea>
    <button type="submit">üíæ L∆∞u</button>
  </form>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, updateDoc, doc, deleteDoc, setDoc } 
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCc61PL3pcx8Bu1dILd_fm7vgA4cnWiCIc",
      authDomain: "hahaohan-9486c.firebaseapp.com",
      projectId: "hahaohan-9486c",
      storageBucket: "hahaohan-9486c.firebasestorage.app",
      messagingSenderId: "820514218791",
      appId: "1:820514218791:web:de9cb93ab77fd35db73f02",
      measurementId: "G-2F8FJYKSN1"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const listEl = document.getElementById("list");
    const form = document.getElementById("productForm");

    // üîπ Load danh s√°ch
    async function loadProducts() {
      listEl.innerHTML = "ƒêang t·∫£i...";
      const querySnapshot = await getDocs(collection(db, "products"));
      listEl.innerHTML = "";
      querySnapshot.forEach((docSnap) => {
        const p = docSnap.data();
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <b>${p.name}</b> (${p.brand})<br>
          CPU: ${p.cpu}, RAM: ${p.ram}, SSD: ${p.ssd}<br>
          Gi√°: ${p.price?.toLocaleString() || 0} VNƒê<br>
          <img src="${p.img}" style="max-width:100px"><br>
          <button onclick="editProduct('${docSnap.id}')">‚úèÔ∏è S·ª≠a</button>
          <button onclick="removeProduct('${docSnap.id}')">üóë X√≥a</button>
        `;
        listEl.appendChild(div);
      });
    }

    // üîπ L∆∞u (th√™m/s·ª≠a)
    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = form.id.value.trim();
      const data = {
        name: form.name.value,
        brand: form.brand.value,
        cpu: form.cpu.value,
        ram: form.ram.value,
        ssd: form.ssd.value,
        screen: form.screen.value,
        price: Number(form.price.value),
        img: form.img.value,
        desc: form.desc.value
      };
      if (id) {
        await setDoc(doc(db, "products", id), data);
        alert("‚úÖ ƒê√£ c·∫≠p nh·∫≠t s·∫£n ph·∫©m!");
      } else {
        await addDoc(collection(db, "products"), data);
        alert("‚úÖ ƒê√£ th√™m s·∫£n ph·∫©m m·ªõi!");
      }
      form.reset();
      loadProducts();
    });

    // üîπ S·ª≠a
    window.editProduct = async function(id) {
      const docRef = doc(db, "products", id);
      const docSnap = await getDocs(collection(db, "products"));
      docSnap.forEach((d) => {
        if (d.id === id) {
          const p = d.data();
          form.id.value = d.id;
          form.name.value = p.name;
          form.brand.value = p.brand;
          form.cpu.value = p.cpu;
          form.ram.value = p.ram;
          form.ssd.value = p.ssd;
          form.screen.value = p.screen;
          form.price.value = p.price;
          form.img.value = p.img;
          form.desc.value = p.desc;
        }
      });
    };

    // üîπ X√≥a
    window.removeProduct = async function(id) {
      if (confirm("X√≥a s·∫£n ph·∫©m n√†y?")) {
        await deleteDoc(doc(db, "products", id));
        loadProducts();
      }
    };

    loadProducts();
  </script>
</body>
</html>
